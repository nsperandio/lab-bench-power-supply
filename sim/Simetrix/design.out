***************************************************************************************************************
***                                                                                                         ***
*** SIMetrix/SIMPLIS Version 8.50i (x64) - 24/02/2026 21:33                                                 ***
*** Platform: Windows 10                                                                                    ***
*** Architecture: x64                                                                                       ***
*** Serial Number: SX600488                                                                                 ***
*** User: Universita Degli Studi Di Udine                                                                   ***
***                                                                                                         ***
*** TITLE:   * C:\Users\nicol\Documents\Projects\lab-bench-power-supply\sim\Simetrix\linear_regulator.wxsch***
*** NETLIST: C:\Users\nicol\Documents\Projects\lab-bench-power-supply\sim\Simetrix\design.net               ***
***                                                                                                         ***
***************************************************************************************************************

********************************************************************************
***                                                                          ***
***                                Input Deck                                ***
***                                                                          ***
********************************************************************************

.options allowdivzero=1
.options initCondMode=2
.options icres=0.002
.options inhibitAttoISource=1
#SIMETRIX
V20 0 VEE 35
C12 Vout 0 1u   
V1 VDD 0 35
C13 R51_N C13_N 100p   
C14 C14_P I2_N 10n   
V3 Vref 0 2.5
C15 R57_P 0 100p   
C16 Q15_B Q5_B 1u   
V5 Iref 0 4
C17 C17_P R47_P 100n   
V6 Vset 0 100m
X7 R52_P X7_inn VDD 0 C13_N PARAM_OPAMP params: A0=100k
+ CMRR=100k
+ GBW=1e6
+ IB=100n
+ IBOS=1n
+ IQ=0.001
+ PSRR=100k
+ RIN=1meg
+ ROUT=100
+ SR_NEG=1e6
+ SR_POS=1e6
+ VDIFF_NEG=0
+ VDIFF_POS=0
+ VOFF_TOL=0
+ VOS=0 
+ GBW2=5 pinnames: inp inn vsp vsn out
X8 X8_inp R47_P VDD 0 R46_N PARAM_OPAMP params: A0=1Meg
+ CMRR=100k
+ GBW=1Meg
+ IB=100n
+ IBOS=1n
+ IQ=1m
+ PSRR=100k
+ RIN=1Meg
+ ROUT=100
+ SR_NEG=1Meg
+ SR_POS=1Meg
+ VDIFF_NEG=0
+ VDIFF_POS=0
+ VOFF_TOL=0
+ VOS=0 
+ GBW2=5 pinnames: inp inn vsp vsn out
X$H4 Iout 0 Q15_C Vout H4$TP_CCVS params: gain=1 pinnames: P N CP CN
.subckt H4$TP_CCVS 1 2 3 4
H1 1 2 V1 {gain} 
V1 3 4
.ends
Q13 Q13_C VG_MIRR R20_N 0 Q2N2904
Q14 VG_MIRR VG_MIRR R23_N 0 Q2N2904
Q15 Q15_C Q15_B V17_P 0 TIP42C
Q16 R16_N R50_P 0 0 Q2N2222
R50 R50_P C13_N 10k
R51 X7_inn R51_N 1k
R52 R52_P Isen 10k
R53 X7_inn Iref 10k
R54 0 R57_P 2k
R55 R47_P Vset 10k
R56 R57_P C17_P 100
R36 V17_P Q15_B 100
R57 R57_P Vsen 10k
R16 I2_N R16_N 100
R37 Vout R37_N 10
R38 Q5_B I2_N 10k
R39 Vout 0 10
X$S4 R37_N 0 S4_CP 0 gen_switch : RON=1  ROFF=1Meg VON=3  VOFF=2  pinnames: P N CP CN
X$V16 S4_CP 0 STEP_SOURCE pinnames: P N params: _V1=0 _V2=5 _FREQ=10k _DELAY=10m _DRATIOx100=50 _T_RISE=50n _T_FALL=50n _DAMP_COEF=0 _PWIDTH=50u _OFF_UNTIL_DELAY=0 _IDLE_IN_POP=1 _USEPHASE=0 _PHASE=10m _SHOWPARAMS=0
V17 V17_P 0 32
Q5 Q15_B Q5_B 0 0 BC337
V18 Vsen Vout AC 100m 0
I2 V17_P I2_N 1m
V19 Isen Iout AC 100m 0
I3 VG_MIRR 0 10m
R20 Vin R20_N 10
R22 Q13_C 0 470
R23 Vin R23_N 10
R46 R16_N R46_N 1k
R47 R47_P C14_P 1k
R48 R57_P R47_P 5k
R49 Vref X8_inp 10k
.KEEP Iout Isen
.GRAPH "db(:Iout/:Isen)" Curvelabel="Gain CC" nowarn=true yunit="dB" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=20 persistence=-1 colourname=Probe1_bode_color   axistype=grid  axisname=bodemag  order=0    userid=Probe1$GAIN. MeasureSpec="Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0"
.post_process probe_measure Probe1$GAIN. Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0
.GRAPH "ph(-:Iout/:Isen)" Curvelabel="Phase CC" nowarn=true yunit="degrees" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=45 persistence=-1 colourname=Probe1_bode_color     axisname=bodephase  order=1    userid=Probe1$PHASE. MeasureSpec="Phase\sMargin\s(Phase\sPlot)|0|0|0|0"
.post_process probe_measure Probe1$PHASE. Phase\sMargin\s(Phase\sPlot)|0|0|0|0
.KEEP Vout Vsen
.GRAPH "db(:Vout/:Vsen)" Curvelabel="Gain CV" nowarn=true yunit="dB" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=20 persistence=-1 colourname=Probe3_bode_color   axistype=grid  axisname=bodemag  order=0    userid=Probe3$GAIN. MeasureSpec="Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0"
.post_process probe_measure Probe3$GAIN. Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0
.GRAPH "ph(-:Vout/:Vsen)" Curvelabel="Phase CV" nowarn=true yunit="degrees" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=45 persistence=-1 colourname=Probe3_bode_color     axisname=bodephase  order=1    userid=Probe3$PHASE. MeasureSpec="Phase\sMargin\s(Phase\sPlot)|0|0|0|0"
.post_process probe_measure Probe3$PHASE. Phase\sMargin\s(Phase\sPlot)|0|0|0|0
.tran 100m
*.ac dec 500 1 1000000
.SUBCKT STEP_SOURCE 1 2 params: _T_RISE=0 _DELAY=0 _V1=0 _V2=1
V1 1 2 PWL 0 {_V1} {_DELAY} {_V1} {_DELAY+_T_RISE} {_V2}
.ENDS
.subckt gen_switch 1 2 3 4
S1 1 2 3 4 SW 
.model SW VSWITCH RON={ron} ROFF={roff} VON={von} VOFF={voff} GIN=0
.ends 
********************************************************************************
**
** Timed switch - this is a comprehensive model with all features.
** Uses new built-in timed switch model. Needs v8+. 
**
********************************************************************************
.subckt PARAM_OPAMP VINP VINN VCC VEE VOUT params:
+ VOS=0 IB=100n IBOS=1n A0=100k GBW=1e6 SR_POS=1e6 SR_NEG=1e6
+ CMRR=100k PSRR=100k RIN=1meg
+ ROUT=100 IQ=0.001 VDIFF_POS=2 VDIFF_NEG=2 VOFF_TOL=0 
*#LABELS ,Offset Voltage,Bias Current,Offset Current,Open-loop Gain,Gain-bandwidth,Pos. Slew Rate,Neg. Slew Rate,CMRR,PSRR,Input Resistance,Output Res.,Quiescent Curr.,Headroom Pos.,Headroom Neg.,Offset V. (Statistical)::-0.1|0.1|10u
.PARAM voffStat = {VOFF_TOL*(GAUSS(1)-1)}
B1ARB1 G4_N G3_P I=ilim*tanh((V(VINN,VINP)-VOS-voffStat)*Gin/ilim) 
V1ARB2 G3_P G4_N 0
** Soft limit using LNCOSH
.PARAM sharp=10
** The first term ensures that there is always at least a tiny amount 
** of gain. No gain at all often leads to problems
** Modified 29.4.03 - correct error with vee and vcc ref.
B1ARB2 C1_P G4_N V=-R*I(V1ARB2)/A0*1e-5 +  ((lncosh(sharp*((-R*I(V1ARB2))-(V(VEE,G4_N)+VDIFF_NEG)))+sharp*(V(VEE,G4_N)+VDIFF_NEG) - (lncosh(sharp*((-R*I(V1ARB2))-(V(VCC,G4_N)-VDIFF_POS)))-sharp*(V(VCC,G4_N)-VDIFF_POS)))/sharp/2)
**B1ARB2 C1_P G4_N V=-R*I(V1ARB2)/A0*1e-5 +  ((lncosh(sharp*((-R*I(V1ARB2))-(V(VEE)+VDIFF_NEG)))+sharp*(V(VEE)+VDIFF_NEG) - (lncosh(sharp*((-R*I(V1ARB2))-(V(VCC)-VDIFF_POS)))-sharp*(V(VCC)-VDIFF_POS)))/sharp/2)
**B1ARB2 C1_P G4_N V=Limit(-R*I(V1ARB2),V(VEE)+VDIFF_NEG, V(VCC)-VDIFF_POS) 
**.ends
V2 V2_P V2_N {Vbias}
V3 V2_N V3_N {Vbias}
** 29.04.03 Split offset and bias into separate generators
I2 VINP G4_N {IB}
IBOS2 VINP G4_N {IBOS/2}
I1 VINN G4_N {IB}
IBOS1 VINN G4_N {-IBOS/2}
C2 V2_N G4_N {1/2/PI/RO/5/gbw}
C1 C1_P G3_P {C}
E2 G4_N VEE VCC VEE 500m
G4 G3_P G4_N VCC G4_N {gin*psgain}
G2 G3_P G4_N VEE G4_N {gin*psgain}
G3 G3_P G4_N VINN G4_N {gin*cmgain/2}
G1 G3_P G4_N VINP G4_N {gin*cmgain/2}
Q2 VEE V3_N VOUT VCC P1
Q1 VCC V2_P VOUT VEE N1
R3 V2_N C1_P {RO}
** 19.8.04 - somehow got left off
RIN VINP VINN {RIN}
.PARAM ILIM = {sqrt(SR_POS)*1e-8}
.PARAM C = {1e-8/sqrt(SR_POS)}
.PARAM Gin = {2*PI*GBW*C}
.PARAM R = {A0/Gin}
.PARAM IS=1e-15
.PARAM BETA=100
** Version 8.1 - fix for Iq/ROUT dependence
** Use NF parameter to get lower emitter resistance.
** To retain behaviour for cases where Iq and Rout
** are compatible, we keep NF at 1.0 wherever possible.
** Reduce in decade steps for Iq*Rout too small.
.PARAM Vt0={BOLTZ*300.15/ECHARGE}
.param NFMAX= {(BETA+1)*ROUT*IQ*2/Vt0/BETA}
.PARAM NF = {IF(NFMAX<1.0, 10^(floor(log10(NFMAX))), 1.0)}
.model N1 npn IS={IS} bf={BETA} NF={NF} T_ABS={IF(NFMAX>=1.0,TEMP,27)}
.model P1 pnp IS={IS} bf={BETA} NF={NF} T_ABS={IF(NFMAX>=1.0,TEMP,27)}
.PARAM Vt={Vt0*NF}
.PARAM cmgain={1.0/CMRR}
.PARAM psgain={1.0/PSRR}
.PARAM VBIAS = {LN(IQ/IS+1)*Vt}
.PARAM RO={(BETA+1)*ROUT-VT/IQ/2*BETA}
.ends
** Peak- peak voltage source
.model Q2N2904 pnp ( IS=3.58E-14 VAF=26.4 BF=120 IKF=0.3416 NE=1.2861
+    ISE=9.574E-14 IKR=0.03 ISC=2.00E-12 NC=1.2 NR=1 BR=5 RC=0.4 CJC=1.80E-11
+    FC=0.5 MJC=0.45 VJC=0.8 CJE=2.65E-11 MJE=0.33 VJE=0.75 TF=4.10E-10
+    ITF=0.54 VTF=3 XTF=20 RE=1.4 TR=8.00E-08)
*From Philips small-signal transistors sc04 1991.
* FT vs Ic estimated (ITF,XTF,XTF) no data available
.model Q2N2222 npn ( IS=2.48E-13 VAF=73.9 BF=400 IKF=0.1962 NE=1.2069
+    ISE=3.696E-14 IKR=0.02 ISC=5.00E-09 NC=2 NR=1 BR=5 RC=0.3 CJC=7.00E-12
+    FC=0.5 MJC=0.5 VJC=0.5 CJE=1.80E-11 MJE=0.5 VJE=1 TF=4.00E-10
+    ITF=2 VTF=10 XTF=10 RE=0.4 TR=4.00E-08)
* 2N2222 with less gain
.model BC337 npn ( IS=8.52E-15 VAF=120.7 BF=280 IKF=1.1412 NE=1.3647
+    ISE=3.562E-14 IKR=0.1 ISC=1.00E-12 NC=1.4 NR=1 BR=10 RC=0.05 CJC=1.20E-11
+    FC=0.5 MJC=0.28 VJC=0.4 CJE=3.10E-11 MJE=0.38 VJE=0.9 TF=4.10E-10
+    ITF=1.5 VTF=3 XTF=25 RE=0.2 TR=1.10E-07)
*From Philips SC04 "Small signal transistors 1991"
* Hfe vs ic from NS Discrete 1978 @ vce = 10V. PS and MOT data @ vce=1v only. TR estimated - no data available
** Modified 26.11.02 ISE parameter incorrect again
.model TIP42C pnp ( IS=7.42E-14 VAF=100.0 BF=150 IKF=0.8884 NE=2.8884
+    ISE=1.302E-08 IKR=0.1 ISC=1.00E-09 NC=2 NR=1 BR=10 RC=0.02 CJC=1.10E-10
+    FC=0.5 MJC=0.25 VJC=0.8 CJE=9.00E-11 MJE=0.33 VJE=0.2 TF=3.20E-08
+    ITF=50 VTF=5 XTF=10 RE=0.08 TR=1.30E-07)
* Motorola, capacitance estimated

********************************************************************************
***                                                                          ***
*** Starting Transient analysis at 21:33                                     ***
***                                                                          ***
*** Analysis card: .tran 100m                                                ***
***                                                                          ***
********************************************************************************
********************************************************************************
***                                                                          ***
***                            Simulation Options                            ***
***                                                                          ***
********************************************************************************
RELTOL                    0.001
ABSTOL                    1e-12
VNTOL                     1e-06
POINTTOL                  0.001
TEMPERATURE               27C
GMIN                      1e-12
Matrix Solver             UF KLU Version 1.1



********************************************************************************
***                                                                          ***
***                             Device parameters                            ***
***                                                                          ***
********************************************************************************
Model parameters for devices of type Switch
===========================================
Model:       S4.SW        

gin          0            
roff         1Meg         
ron          1            
voff         2            
von          3            


Model parameters for devices of type BJT
========================================
Model:       BC337        Q2N2222      Q2N2904      TIP42C       X7.N1        

bf           280          400          120          150          100          
br           10           5            5            10           1            
cjc          12p          7p           18p          110p         0            
cje          31p          18p          26.5p        90p          0            
fc           500m         500m         500m         500m         500m         
ikf          1.1412       196.2m       341.6m       888.4m       0            
ikr          100m         20m          30m          100m         0            
is           8.52f        248f         35.8f        74.2f        1f           
isc          1p           5n           2p           1n           0            
ise          35.62f       36.96f       95.74f       13.02n       0            
itf          1.5          2            540m         50           0            
mjc          280m         500m         450m         250m         330m         
mje          380m         500m         330m         330m         330m         
nc           1.4          2            1.2          2            2            
ne           1.3647       1.2069       1.2861       2.8884       1.5          
nf           1            1            1            1            1            
nr           1            1            1            1            1            
rc           50m          300m         400m         20m          0            
re           200m         400m         1.4          80m          0            
t_abs        0            0            0            0            27           
tf           410p         400p         410p         32n          0            
tr           110n         40n          80n          130n         0            
vaf          120.7        73.9         26.4         100          0            
vjc          400m         500m         800m         800m         750m         
vje          900m         1            750m         200m         750m         
vtf          3            10           3            5            0            
xtf          25           10           20           10           0            

Model:       X7.P1        X8.N1        X8.P1        

bf           100          100          100          
br           1            1            1            
cjc          0            0            0            
cje          0            0            0            
fc           500m         500m         500m         
ikf          0            0            0            
ikr          0            0            0            
is           1f           1f           1f           
isc          0            0            0            
ise          0            0            0            
itf          0            0            0            
mjc          330m         330m         330m         
mje          330m         330m         330m         
nc           2            2            2            
ne           1.5          1.5          1.5          
nf           1            1            1            
nr           1            1            1            
rc           0            0            0            
re           0            0            0            
t_abs        27           27           27           
tf           0            0            0            
tr           0            0            0            
vaf          0            0            0            
vjc          750m         750m         750m         
vje          750m         750m         750m         
vtf          0            0            0            
xtf          0            0            0            


Analysis statistics
===================

Nominal temperature = 27
Operating temperature = 27
Total iterations = 331083
Transient iterations = 329192
Transient timepoints = 32979
Accepted timepoints = 25957
Total analysis time = 7.062
Transient time = 0
Matrix reordering time = 0
L-U decomposition time = 0
Matrix solve time = 0
Load time = 0
Transient L-U decomp time = 0
Transient solve time = 0
Circuit build time = 0
Simulator initialise time = 0
Data write time = 0
Convergence test time = 0
LTE time = 0
JI2 Iterations = 100
Diag. GMIN stepping iterations = 0
Junc. GMIN stepping iterations = 0
Source stepping iterations = 1791
PTA iterations = 0
Number of matrix fill ins = 4
Number of initial matrix elements = 257
Circuit equations = 77
State vector size = 378
Number of write buffer faults = 0

Run statistics
==============

Netlist read in time = 0.14
Total run time = 7.453 seconds
Analysis concluded 24/02/2026 21:33
