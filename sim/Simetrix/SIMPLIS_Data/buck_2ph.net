* C:\Users\nicol\Documents\Projects\lab-bench-power-supply\sim\Simetrix\buck_2ph.wxsch
*#SIMETRIX
.node_map G_L2 131
.node_map G_H2 129
.node_map Vsen 112
.node_map Vdd 124
.node_map Isen 114
.node_map Vdrive 121
.node_map CLK2 120
.node_map Islope1 122
.node_map Isen1 128
.node_map Islope2 123
.node_map Isen2 130
.node_map G_H 118
.node_map G_L 127
.node_map S1 116
.node_map S2 117
.node_map Iout1 126
.node_map CLK 119
.node_map Vout 113
.node_map Iout 115
.node_map G_SW 125
*.ac DEC 100 1k 1Meg
.print
+ ALL
.options
+ PSP_NPT=50001
+ POP_ITRMAX=20
+ POP_USE_TRAN_SNAPSHOT
+ POP_OUTPUT_CYCLES=5
+ SNAPSHOT_INTVL=0
+ SNAPSHOT_NPT=11
+ MIN_AVG_TOPOLOGY_DUR=1a
+ AVG_TOPOLOGY_DUR_MEASUREMENT_WINDOW=128
*.pop TRIG_GATE={TRIG_GATE} TRIG_COND=0_TO_1 MAX_PERIOD=6u CONVERGENCE=1p CYCLES_BEFORE_LAUNCH=40 TD_RUN_AFTER_POP_FAILS=-1
.tran 10m 0


C1 76 0 100n
C2 76 78 47u
C3 113 0 4.7u
C4 99 98 10n
C6 76 0 100n
C7 76 83 47u
E1 131 0 111 0 1
E2 118 125 87 0 1
E3 127 0 97 0 1
E4 129 116 101 0 1
X$H1 130 0 84 80 H1$TP_CCVS vars: gain=1
.subckt H1$TP_CCVS 1 2 3 4
.node_map P 1
.node_map N 2
.node_map CP 3
.node_map CN 4
H1 1 2 V1 {gain}
V1 3 4 0
.ends
X$H2 126 0 79 80 H2$TP_CCVS vars: gain=1
.subckt H2$TP_CCVS 1 2 3 4
.node_map P 1
.node_map N 2
.node_map CP 3
.node_map CN 4
H1 1 2 V1 {gain}
V1 3 4 0
.ends
X$H3 115 0 80 113 H3$TP_CCVS vars: gain=1
.subckt H3$TP_CCVS 1 2 3 4
.node_map P 1
.node_map N 2
.node_map CP 3
.node_map CN 4
H1 1 2 V1 {gain}
V1 3 4 0
.ends
.PRINT V(#Vout)
.PRINT V(#Vsen)
.GRAPH "db(:#Vout/:#Vsen)" Curvelabel="V Gain" nowarn=true yunit="dB" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=20 persistence=-1 colourname=Probe1_bode_color   axistype=grid axisname=bodemag order=0    userid=Probe1$GAIN. MeasureSpec="Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0"
.post_process probe_measure Probe1$GAIN. Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0
.GRAPH "ph(:#Vout/:#Vsen)" Curvelabel="V Phase" nowarn=true yunit="degrees" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=45 persistence=-1 colourname=Probe1_bode_color    axisname=bodephase order=1    userid=Probe1$PHASE. MeasureSpec="Phase\sMargin\s(Phase\sPlot)|0|0|0|0"
.post_process probe_measure Probe1$PHASE. Phase\sMargin\s(Phase\sPlot)|0|0|0|0
.PRINT V(#Iout)
.PRINT V(#Isen)
.GRAPH "db(:#Iout/:#Isen)" Curvelabel="I Gain" nowarn=true yunit="dB" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=20 persistence=-1 colourname=Probe3_bode_color   axistype=grid axisname=bodemag order=0    userid=Probe3$GAIN. MeasureSpec="Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0"
.post_process probe_measure Probe3$GAIN. Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0
.GRAPH "ph(:#Iout/:#Isen)" Curvelabel="I Phase" nowarn=true yunit="degrees" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=45 persistence=-1 colourname=Probe3_bode_color    axisname=bodephase order=1    userid=Probe3$PHASE. MeasureSpec="Phase\sMargin\s(Phase\sPlot)|0|0|0|0"
.post_process probe_measure Probe3$PHASE. Phase\sMargin\s(Phase\sPlot)|0|0|0|0
X$Q1 76 118 125 PWR_NMOS_SPICE_V3 vars: USER_COSS=3.0368n CDG_NSEG=0 RDSon=850.947u VCGS1=1 MAX_ROFF=100Meg QCDS1=106.288n VD_PEAK=35 VGSON=10 ID_PEAK=5 LIMIT_MAX_ROFF=1 VCDS0=0 TEMP=25 BD_NSEG=4 LEVEL=1 ROFF=100Meg QCGS0=0 VT0=1.80389 HYSTWD=180.389m VGS2=2.80389 VCGS0=0 ID2=46.341 VCDS1=35 RG=809.845m KP1=333.333m KP2=1 REV_BIAS=0 REV_BIAS_SEGS=2 VD0=-10.001k IBD0=-1 VD1=-10k IBD1=0 VD2=627.507m IBD2=0 VD3=690.637m USE_EXTRACTED=1 IBD3=1.54366 VD4=719.911m IBD4=5 CGS_NSEG=1 QCGS1=6.64552n LABEL='USER_LABEL' CDS_NSEG=1 QCDS0=0 DEVICE='BSC010N04LS_L1' USER_DIODE_FWD_RES=8.46961m USER_RDSON=850.947u USER_ROFF=100Meg USER_VT0=1.80389 USER_HYSTWD=180.389m USER_DIODE_FWD_VOLTAGE=677.563m USER_CGS=6.64552n USER_RG=809.845m REF='Q1'

X$Q2 125 127 0 PWR_NMOS_SPICE_V3 vars: USER_COSS=3.0368n CDG_NSEG=0 RDSon=850.947u VCGS1=1 MAX_ROFF=100Meg QCDS1=106.288n VD_PEAK=35 VGSON=10 ID_PEAK=5 LIMIT_MAX_ROFF=1 VCDS0=0 TEMP=25 BD_NSEG=4 LEVEL=1 ROFF=100Meg QCGS0=0 VT0=1.80389 HYSTWD=180.389m VGS2=2.80389 VCGS0=0 ID2=46.341 VCDS1=35 RG=809.845m KP1=333.333m KP2=1 REV_BIAS=0 REV_BIAS_SEGS=2 VD0=-10.001k IBD0=-1 VD1=-10k IBD1=0 VD2=627.507m IBD2=0 VD3=690.637m USE_EXTRACTED=1 IBD3=1.54366 VD4=719.911m IBD4=5 CGS_NSEG=1 QCGS1=6.64552n LABEL='USER_LABEL' CDS_NSEG=1 QCDS0=0 DEVICE='BSC010N04LS_L1' USER_DIODE_FWD_RES=8.46961m USER_RDSON=850.947u USER_ROFF=100Meg USER_VT0=1.80389 USER_HYSTWD=180.389m USER_DIODE_FWD_VOLTAGE=677.563m USER_CGS=6.64552n USER_RG=809.845m REF='Q2'

X$Q3 116 131 0 PWR_NMOS_SPICE_V3 vars: USER_COSS=3.0368n CDG_NSEG=0 RDSon=850.947u VCGS1=1 MAX_ROFF=100Meg QCDS1=106.288n VD_PEAK=35 VGSON=10 ID_PEAK=5 LIMIT_MAX_ROFF=1 VCDS0=0 TEMP=25 BD_NSEG=4 LEVEL=1 ROFF=100Meg QCGS0=0 VT0=1.80389 HYSTWD=180.389m VGS2=2.80389 VCGS0=0 ID2=46.341 VCDS1=35 RG=809.845m KP1=333.333m KP2=1 REV_BIAS=0 REV_BIAS_SEGS=2 VD0=-10.001k IBD0=-1 VD1=-10k IBD1=0 VD2=627.507m IBD2=0 VD3=690.637m USE_EXTRACTED=1 IBD3=1.54366 VD4=719.911m IBD4=5 CGS_NSEG=1 QCGS1=6.64552n LABEL='USER_LABEL' CDS_NSEG=1 QCDS0=0 DEVICE='BSC010N04LS_L1' USER_DIODE_FWD_RES=8.46961m USER_RDSON=850.947u USER_ROFF=100Meg USER_VT0=1.80389 USER_HYSTWD=180.389m USER_DIODE_FWD_VOLTAGE=677.563m USER_CGS=6.64552n USER_RG=809.845m REF='Q3'

X$Q4 76 129 116 PWR_NMOS_SPICE_V3 vars: USER_COSS=3.0368n CDG_NSEG=0 RDSon=850.947u VCGS1=1 MAX_ROFF=100Meg QCDS1=106.288n VD_PEAK=35 VGSON=10 ID_PEAK=5 LIMIT_MAX_ROFF=1 VCDS0=0 TEMP=25 BD_NSEG=4 LEVEL=1 ROFF=100Meg QCGS0=0 VT0=1.80389 HYSTWD=180.389m VGS2=2.80389 VCGS0=0 ID2=46.341 VCDS1=35 RG=809.845m KP1=333.333m KP2=1 REV_BIAS=0 REV_BIAS_SEGS=2 VD0=-10.001k IBD0=-1 VD1=-10k IBD1=0 VD2=627.507m IBD2=0 VD3=690.637m USE_EXTRACTED=1 IBD3=1.54366 VD4=719.911m IBD4=5 CGS_NSEG=1 QCGS1=6.64552n LABEL='USER_LABEL' CDS_NSEG=1 QCDS0=0 DEVICE='BSC010N04LS_L1' USER_DIODE_FWD_RES=8.46961m USER_RDSON=850.947u USER_ROFF=100Meg USER_VT0=1.80389 USER_HYSTWD=180.389m USER_DIODE_FWD_VOLTAGE=677.563m USER_CGS=6.64552n USER_RG=809.845m REF='Q4'

R1 76 75 100m
R10 84 117 10m
R2 78 0 10m
R3 79 77 10m
R4 113 0 5
R5 83 0 10m
R6 113 81 5
R7 94 99 8k
R8 98 112 10k
X$S1 81 0 82 0 SIMPLIS_VC_SWITCH vars: ROFF=1Meg RON=1n THRESHOLD=2 HYSTWD=100m IC='OPEN' LOGIC='POS'
X$TX2 125 77 116 117 Ideal_TxTX2 
.subckt Ideal_TxTX2 10 11 20 21 
.node_map P1P 10 
.node_map P1N 11 
.node_map S1P 20 
.node_map S1N 21 
L1 10 11 100u 
L2 20 21 100u 
M-L1-L2 85u 
 
.ends 

X$U1 86 93 0 119 91 SIMPLIS_DIGI1_SRLATCH_Y vars: IC=0  RIN=10Meg ROUT=10 TH=2.5 HYSTWD=1 VOL=0 VOH=5  OUT_DELAY=2p SET_RESET_LEVEL=1 GNDREF='Y'  DOM='R' 
X$U10 105 0 130 123 SIMPLIS_SUMMER2_BB vars: K1=1 K2=1
+ OFFSET=0 USE_RIN=0 RIN=10k
X$U11 110 111 0 103 100 SIMPLIS_DIGI1_OR2_Y vars: NumInv=0 IC=0 RIN=10Meg ROUT=10 HYSTWD=1 VOL=0 VOH=10 DELAY=2p TH=2.5
X$U12 103 107 0 100 SIMPLIS_DIGI1_BUF_Y vars: IC=0 RIN=10Meg ROUT=10 HYSTWD=1 VOL=0 VOH=5 DELAY=100n TH=2.5
X$U2 88 92 0 86 SIMPLIS_DIGI1_BUF_Y vars: IC=0 RIN=10Meg ROUT=10 HYSTWD=1 VOL=0 VOH=5 DELAY=100n TH=2.5
X$U3 87 89 0 86 88 SIMPLIS_DIGI1_AND2_Y vars: NumInv=0 IC=0 RIN=10Meg ROUT=10 HYSTWD=1 VOL=0 VOH=10 DELAY=2p TH=2.5
X$U4 96 97 0 88 86 SIMPLIS_DIGI1_OR2_Y vars: NumInv=0 IC=0 RIN=10Meg ROUT=10 HYSTWD=1 VOL=0 VOH=10 DELAY=2p TH=2.5
X$U5 106 109 0 105 94 SIMPLIS_DIGI1_COMP_Y vars: IC=0 RIN=10Meg ROUT=10 HYSTWD=2M VOL=0 VOH=5 DELAY=2p
X$U6 101 104 0 100 103 SIMPLIS_DIGI1_AND2_Y vars: NumInv=0 IC=0 RIN=10Meg ROUT=10 HYSTWD=1 VOL=0 VOH=10 DELAY=2p TH=2.5
X$U7 91 95 0 90 94 SIMPLIS_DIGI1_COMP_Y vars: IC=0 RIN=10Meg ROUT=10 HYSTWD=2M VOL=0 VOH=5 DELAY=2p
X$U8 90 0 128 122 SIMPLIS_SUMMER2_BB vars: K1=1 K2=1
+ OFFSET=0 USE_RIN=0 RIN=10k
X$U9 100 108 0 120 106 SIMPLIS_DIGI1_SRLATCH_Y vars: IC=0  RIN=10Meg ROUT=10 TH=2.5 HYSTWD=1 VOL=0 VOH=5  OUT_DELAY=2p SET_RESET_LEVEL=1 GNDREF='Y'  DOM='R' 
X$V1 119 0 PUL_SOURCE vars: _V1=0 _V2=5 _FREQ=200k _DELAY=0 _DRATIOx100=1 _T_RISE=5n _T_FALL=5n _DAMP_COEF=0 _PWIDTH=45n _OFF_UNTIL_DELAY=0 _IDLE_IN_POP=0 _USEPHASE=1 _PHASE=0 _SHOWPARAMS=0
V10 128 126 AC 1
V11 114 115 AC 1
X$V12 82 0 STEP_SOURCE vars: _V1=0 _V2=5 _FREQ=10k _DELAY=5m _DRATIOx100=50 _T_RISE=0 _T_FALL=0 _DAMP_COEF=0 _PWIDTH=50u _OFF_UNTIL_DELAY=0 _IDLE_IN_POP=1 _USEPHASE=0 _PHASE=5m _SHOWPARAMS=0
V2 75 0 35
X$V3 122 0 SAW_SOURCE vars: _V1=0 _V2=700m _FREQ=200k _DELAY=0 _DRATIOx100=100 _T_RISE=5u _T_FALL=0 _DAMP_COEF=0 _PWIDTH=0 _OFF_UNTIL_DELAY=0 _IDLE_IN_POP=0 _USEPHASE=1 _PHASE=0 _SHOWPARAMS=0
V4 121 0 10
X$V5 120 0 PUL_SOURCE vars: _V1=0 _V2=5 _FREQ=200k _DELAY=180 _DRATIOx100=1 _T_RISE=5n _T_FALL=5n _DAMP_COEF=0 _PWIDTH=45n _OFF_UNTIL_DELAY=0 _IDLE_IN_POP=0 _USEPHASE=1 _PHASE=180 _SHOWPARAMS=0
V6 112 113 AC 1
V7 124 0 12
V8 102 0 12
X$V9 123 0 SAW_SOURCE vars: _V1=0 _V2=700m _FREQ=200k _DELAY=180 _DRATIOx100=100 _T_RISE=5u _T_FALL=0 _DAMP_COEF=0 _PWIDTH=0 _OFF_UNTIL_DELAY=0 _IDLE_IN_POP=0 _USEPHASE=1 _PHASE=180 _SHOWPARAMS=0
X1 102 98 124 0 94 PARAM_OPAMP vars: A0=100k
+ CMRR=100k
+ GBW=1Meg
+ IB=100n
+ IBOS=1n
+ IO_SNK_MAX=5m
+ IO_SRC_MAX=5m
+ IQ=1m
+ LEVEL=2
+ PSRR=100k
+ RIN=1Meg
+ ROUT=100
+ RO_AC=50
+ SR_NEG=1Meg
+ SR_POS=1Meg
+ VDIFF_NEG=0
+ VDIFF_POS=0
+ VOS=0

X2 119 85 PERIODIC_OP vars: VREF=2.5 VOL=0 VOH=5 HYSTWD=2 DIVIDE_BY_2=0 IC=0 DELAY=0 TRIG_COND='0_TO_1'

.end
