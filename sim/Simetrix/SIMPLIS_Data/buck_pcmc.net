* C:\Users\nicol\Documents\Projects\lab-bench-power-supply\sim\Simetrix\buck_pcmc.wxsch
*#SIMETRIX
.node_map Vdd 75
.node_map Vsen 69
.node_map G_H 71
.node_map Vout 70
.node_map CLK 72
.node_map Islope 74
.node_map G_SW 76
.node_map Vdrive 73
.node_map Isen 77
.node_map G_L 78
*.ac DEC 100 1k 1Meg
.print
+ ALL
.options
+ PSP_NPT=50001
+ POP_ITRMAX=20
+ POP_USE_TRAN_SNAPSHOT
+ POP_OUTPUT_CYCLES=5
+ SNAPSHOT_INTVL=0
+ SNAPSHOT_NPT=11
+ MIN_AVG_TOPOLOGY_DUR=1a
+ AVG_TOPOLOGY_DUR_MEASUREMENT_WINDOW=128
*.pop TRIG_GATE={TRIG_GATE} TRIG_COND=0_TO_1 MAX_PERIOD=6u CONVERGENCE=1p CYCLES_BEFORE_LAUNCH=40 TD_RUN_AFTER_POP_FAILS=-1
.tran 10m 0


C1 39 0 100n
C2 39 40 47u
C3 70 0 4.7u
C4 67 66 2.7n
E2 71 76 51 0 1
E3 78 0 65 0 1
X$H2 77 0 42 70 H2$TP_CCVS vars: gain=1
.subckt H2$TP_CCVS 1 2 3 4
.node_map P 1
.node_map N 2
.node_map CP 3
.node_map CN 4
H1 1 2 V1 {gain}
V1 3 4 0
.ends
L2 76 41 47u
.PRINT V(#Vout)
.PRINT V(#Vsen)
.GRAPH "db(:#Vout/:#Vsen)" GUID="ca7fd7d0-a565-4306-93e8-986df418fe60" Curvelabel="Gain" nowarn=true yunit="dB" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=20 persistence=-1 colourname=Probe1_bode_color    axisname=bodemag order=1    userid=Probe1$GAIN. MeasureSpec="Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0"
.post_process probe_measure Probe1$GAIN. Gain\sCrossover\sFrequency\s(dB\sPlot)|0|0|0|0!Gain\sMargin\s(dB\sPlot)|0|0|0|0
.GRAPH "ph(:#Vout/:#Vsen)" Curvelabel="Phase" nowarn=true yunit="degrees" complete=True analysis="ac" ylog=lin xlog=auto  ydelta=45 persistence=-1 colourname=Probe1_bode_color   axistype=grid axisname=bodephase order=0    userid=Probe1$PHASE. MeasureSpec="Phase\sMargin\s(Phase\sPlot)|0|0|0|0"
.post_process probe_measure Probe1$PHASE. Phase\sMargin\s(Phase\sPlot)|0|0|0|0
X$Q1 39 71 76 PWR_NMOS_SPICE_V3 vars: USER_COSS=3.0368n CDG_NSEG=0 RDSon=850.947u VCGS1=1 MAX_ROFF=100Meg QCDS1=106.288n VD_PEAK=35 VGSON=10 ID_PEAK=5 LIMIT_MAX_ROFF=1 VCDS0=0 TEMP=25 BD_NSEG=4 LEVEL=1 ROFF=100Meg QCGS0=0 VT0=1.80389 HYSTWD=180.389m VGS2=2.80389 VCGS0=0 ID2=46.341 VCDS1=35 RG=809.845m KP1=333.333m KP2=1 REV_BIAS=0 REV_BIAS_SEGS=2 VD0=-10.001k IBD0=-1 VD1=-10k IBD1=0 VD2=627.507m IBD2=0 VD3=690.637m USE_EXTRACTED=1 IBD3=1.54366 VD4=719.911m IBD4=5 CGS_NSEG=1 QCGS1=6.64552n LABEL='USER_LABEL' CDS_NSEG=1 QCDS0=0 DEVICE='BSC010N04LS_L1' USER_DIODE_FWD_RES=8.46961m USER_RDSON=850.947u USER_ROFF=100Meg USER_VT0=1.80389 USER_HYSTWD=180.389m USER_DIODE_FWD_VOLTAGE=677.563m USER_CGS=6.64552n USER_RG=809.845m REF='Q1'

X$Q2 76 78 0 PWR_NMOS_SPICE_V3 vars: USER_COSS=3.0368n CDG_NSEG=0 RDSon=850.947u VCGS1=1 MAX_ROFF=100Meg QCDS1=106.288n VD_PEAK=35 VGSON=10 ID_PEAK=5 LIMIT_MAX_ROFF=1 VCDS0=0 TEMP=25 BD_NSEG=4 LEVEL=1 ROFF=100Meg QCGS0=0 VT0=1.80389 HYSTWD=180.389m VGS2=2.80389 VCGS0=0 ID2=46.341 VCDS1=35 RG=809.845m KP1=333.333m KP2=1 REV_BIAS=0 REV_BIAS_SEGS=2 VD0=-10.001k IBD0=-1 VD1=-10k IBD1=0 VD2=627.507m IBD2=0 VD3=690.637m USE_EXTRACTED=1 IBD3=1.54366 VD4=719.911m IBD4=5 CGS_NSEG=1 QCGS1=6.64552n LABEL='USER_LABEL' CDS_NSEG=1 QCDS0=0 DEVICE='BSC010N04LS_L1' USER_DIODE_FWD_RES=8.46961m USER_RDSON=850.947u USER_ROFF=100Meg USER_VT0=1.80389 USER_HYSTWD=180.389m USER_DIODE_FWD_VOLTAGE=677.563m USER_CGS=6.64552n USER_RG=809.845m REF='Q2'

R1 39 38 100m
R2 40 0 10m
R3 42 41 10m
R4 70 0 6
R7 62 67 8k
R8 66 69 10k
X$U1 50 58 0 72 56 SIMPLIS_DIGI1_SRLATCH_Y vars: IC=0  RIN=10Meg ROUT=10 TH=2.5 HYSTWD=1 VOL=0 VOH=5  OUT_DELAY=2p SET_RESET_LEVEL=1 GNDREF='Y'  DOM='R' 
X$U2 53 57 0 50 SIMPLIS_DIGI1_BUF_Y vars: IC=0 RIN=10Meg ROUT=10 HYSTWD=1 VOL=0 VOH=5 DELAY=100n TH=2.5
X$U3 51 54 0 50 53 SIMPLIS_DIGI1_AND2_Y vars: NumInv=0 IC=0 RIN=10Meg ROUT=10 HYSTWD=1 VOL=0 VOH=10 DELAY=2p TH=2.5
X$U4 64 65 0 53 50 SIMPLIS_DIGI1_OR2_Y vars: NumInv=0 IC=0 RIN=10Meg ROUT=10 HYSTWD=1 VOL=0 VOH=10 DELAY=2p TH=2.5
X$U7 56 63 0 55 62 SIMPLIS_DIGI1_COMP_Y vars: IC=0 RIN=10Meg ROUT=10 HYSTWD=2M VOL=0 VOH=5 DELAY=2p
X$U8 55 0 77 74 SIMPLIS_SUMMER2_BB vars: K1=1 K2=1
+ OFFSET=0 USE_RIN=0 RIN=10k
X$V1 72 0 PUL_SOURCE vars: _V1=0 _V2=5 _FREQ=200k _DELAY=0 _DRATIOx100=1 _T_RISE=5n _T_FALL=5n _DAMP_COEF=0 _PWIDTH=45n _OFF_UNTIL_DELAY=0 _IDLE_IN_POP=0 _USEPHASE=0 _PHASE=0 _SHOWPARAMS=0
V2 38 0 35
X$V3 74 0 SAW_SOURCE vars: _V1=0 _V2=660m _FREQ=200k _DELAY=0 _DRATIOx100=100 _T_RISE=5u _T_FALL=0 _DAMP_COEF=0 _PWIDTH=0 _OFF_UNTIL_DELAY=0 _IDLE_IN_POP=0 _USEPHASE=0 _PHASE=0 _SHOWPARAMS=0
V4 73 0 10
V6 69 70 AC 1
V7 75 0 12
V8 68 0 20
X1 68 66 75 0 62 PARAM_OPAMP vars: A0=100k
+ CMRR=100k
+ GBW=1Meg
+ IB=100n
+ IBOS=1n
+ IO_SNK_MAX=5m
+ IO_SRC_MAX=5m
+ IQ=1m
+ LEVEL=2
+ PSRR=100k
+ RIN=1Meg
+ ROUT=100
+ RO_AC=50
+ SR_NEG=1Meg
+ SR_POS=1Meg
+ VDIFF_NEG=0
+ VDIFF_POS=0
+ VOS=0

X2 72 49 PERIODIC_OP vars: VREF=2.5 VOL=0 VOH=5 HYSTWD=2 DIVIDE_BY_2=0 IC=0 DELAY=0 TRIG_COND='0_TO_1'

.end
